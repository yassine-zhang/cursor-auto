# compareEmails 使用文档

[返回主页](../../README.md)

## 功能介绍

`compareEmails` 是一个用于比较和分析不同来源邮箱数据的工具。它主要用于对比 JSON 文件中的用户数据和 Excel 表格中的邮箱列表，帮助发现数据差异和重复项。

## 主要功能

1. 读取并分析 JSON 文件中的用户数据
2. 读取 Excel 表格中的邮箱列表
3. 检测重复邮箱
4. 查找未在 JSON 中出现的邮箱
5. 查找仅在 JSON 中存在的邮箱
6. 生成详细的分析报告

## 使用前提

1. 确保已安装 Bun 运行环境
2. 项目根目录下存在 `data` 文件夹，包含团队数据的 JSON 文件
3. Excel 文件路径正确配置

## 数据要求

### JSON 文件格式

- 位置：`./data` 目录
- 命名规则：`team-{团队名称}-data.json`
- 数据结构：

```json
{
  "timestamp": "时间戳",
  "totalMembers": 成员数量,
  "members": [
    {
      "name": "用户名",
      "email": "邮箱",
      "lastUsed": "最后使用时间",
      "role": "角色"
    }
  ]
}
```

### Excel 文件要求

- 包含两个工作表：`self-invited-users` 和 `partner-invited`
- 每个工作表的 A 列存储邮箱数据
- 第一行为表头，数据从第二行开始

## 运行方式

```bash
bun run src/scripts/compareEmails.ts
```

## 输出内容

1. **控制台输出**

   - JSON 文件中的用户数据统计
   - Excel 表格中的邮箱数量统计
   - 重复邮箱列表（如果存在）
   - 数据差异分析结果

2. **文件输出**
   - `not_found_in_json.txt`: 记录在 Excel 中存在但在 JSON 中未找到的邮箱
   - `json_only_emails.txt`: 记录仅在 JSON 中存在的邮箱

## 输出格式说明

### 表格显示格式

```
序号 | 团队 | 用户名 | 邮箱 | 角色 | 最后使用时间
================================================
1    | [团队] | 用户名 | email@example.com | 角色 | 2024-01-01
```

### 邮箱列表格式

```
序号 | 邮箱                  | 序号 | 邮箱                  | 序号 | 邮箱
==========================================================================
1    | email1@example.com    | 2    | email2@example.com    | 3    | email3@example.com
```

## 交互功能

程序运行时会询问是否显示详细信息，输入 `y` 或 `n` 进行选择：

- `y`: 显示完整的数据分析结果
- `n`: 仅显示统计信息和关键差异

## 注意事项

1. 邮箱比较不区分大小写
2. 所有输出文件将保存在项目根目录
3. 确保有足够的权限读取 Excel 文件和写入输出文件
4. 程序会自动处理重复数据，无需手动预处理

## 错误处理

如果遇到错误，程序会在控制台输出具体的错误信息，常见错误包括：

- 文件读取权限问题
- JSON 文件格式错误
- Excel 文件不存在或格式不正确

## 建议用法

1. 定期运行此工具以监控团队成员数据的变化
2. 使用输出文件进行后续的数据处理和分析
3. 根据分析结果及时更新相关系统中的用户数据
